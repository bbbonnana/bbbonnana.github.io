<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript核心</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.47ef6698.js" as="script"><link rel="preload" href="/assets/js/2.6d8ae55b.js" as="script"><link rel="preload" href="/assets/js/12.5c9e598e.js" as="script"><link rel="prefetch" href="/assets/js/10.f387a10f.js"><link rel="prefetch" href="/assets/js/11.c1b4cb0b.js"><link rel="prefetch" href="/assets/js/13.537bc5a1.js"><link rel="prefetch" href="/assets/js/14.9ede1c62.js"><link rel="prefetch" href="/assets/js/15.a28880a7.js"><link rel="prefetch" href="/assets/js/16.5466c073.js"><link rel="prefetch" href="/assets/js/17.65bdf248.js"><link rel="prefetch" href="/assets/js/3.924945c2.js"><link rel="prefetch" href="/assets/js/4.5fa47ea8.js"><link rel="prefetch" href="/assets/js/5.26e38a66.js"><link rel="prefetch" href="/assets/js/6.adbc6dbc.js"><link rel="prefetch" href="/assets/js/7.d1d73f47.js"><link rel="prefetch" href="/assets/js/8.2b10522a.js"><link rel="prefetch" href="/assets/js/9.87a41797.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">前端小记</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>端外基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basis/protocol/" class="sidebar-link">互联网协议</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>核心前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>HTML &amp; CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/core/js/js-core/" aria-current="page" class="active sidebar-link">JavaScript核心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/core/js/js-core/#变量与函数" class="sidebar-link">变量与函数</a></li><li class="sidebar-sub-header"><a href="/core/js/js-core/#对象" class="sidebar-link">对象</a></li><li class="sidebar-sub-header"><a href="/core/js/js-core/#json" class="sidebar-link">JSON</a></li></ul></li><li><a href="/core/js/es6/" class="sidebar-link">ES6特性</a></li><li><a href="/core/js/regex/" class="sidebar-link">JavaScript正则表达式</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端工程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/development/build/webpack/" class="sidebar-link">Webpack原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/framework/vue/source/" class="sidebar-link">VUE2 源码分析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node-js/server/http/" class="sidebar-link">Node.js中搭建HTTP服务器</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript核心"><a href="#javascript核心" class="header-anchor">#</a> JavaScript核心</h1> <h2 id="变量与函数"><a href="#变量与函数" class="header-anchor">#</a> 变量与函数</h2> <h3 id="var-关键字"><a href="#var-关键字" class="header-anchor">#</a> var 关键字</h3> <p>Javascript中的作用域为函数作用域，用var定义的变量即显式声明该作用域中的变量，若为隐式声明则会变成全局变量，对于全局变量，将成为浏览器中window对象中的属性。此外，在全局域中用Var显式声明的变量不能用Delete删除。</p> <h3 id="变量提升与函数提升"><a href="#变量提升与函数提升" class="header-anchor">#</a> 变量提升与函数提升</h3> <ul><li>JavaScript中，函数及变量的声明都将被提升到函数的最顶部。</li> <li>JavaScript中，变量可以在使用后声明，也就是变量可以先使用再声明（let const关键字除外）。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 初始化 x</span>
elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查找元素 </span>
elem<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> y<span class="token punctuation">;</span>           <span class="token comment">// 显示 x 和 y</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// 初始化 y</span>

<span class="token comment">/* ***上述代码将如下述般执行*** */</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 初始化 x</span>
<span class="token keyword">var</span> y<span class="token punctuation">;</span>     <span class="token comment">// 声明 y</span>
elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查找元素</span>
elem<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> y<span class="token punctuation">;</span>           <span class="token comment">// 显示 x 和 y</span>
y <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token comment">// 设置 y 为 7</span>
</code></pre></div><p>js中创建函数有两种方式：函数声明式和函数字面量式。只有函数声明才存在函数提升！如:</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function f1() {}   </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined  </span>
<span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">f2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h3> <p>闭包是函数和声明该函数的词法环境的组合。常见函数闭包与对象闭包：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 函数闭包：</span>
<span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token comment">// 对象闭包：</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">f</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">// 即对象 a</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="作用域链"><a href="#作用域链" class="header-anchor">#</a> 作用域链</h3> <p>每个函数都有自己的执行环境，其中 <strong>执行环境定义了变量或函数有权访问的其他数据，而每个执行环境都有一个与之关联的变量对象，环境中定义的所有变量和函数都保存在这个变量</strong> 中，虽然我们无法访问这个对象，但解析器在处理数据时会在后台使用它。当执行流进入一个函数时，函数的环境便会被推入一个环境栈中，执行完毕后栈再将其环境弹出，把控制权返回给之前的执行环境。</p> <p>当代码在一个环境中执行时，会创建变量对象的一个作用域链以保证对执行环境有权访问的所有变量及函数的有序访问。<strong>作用域前端始终是当前执行代码所在的<code>环境对象</code></strong>。如果这个环境是函数，则将其活动对象作为变量对象，活动对象最开始只包含一个变量 (即**<code>arguments</code><strong>对象)。作用域链中下一个变量对象来自外部环境，而再下一个变量对象则来自下一个包含环境，这样便一直顺延到全局执行环境。全局执行环境的变量对象即</strong><code>window</code>**对象始终是作用域链中的最后一个对象。</p> <p>详细可参考：<strong>https://segmentfault.com/a/1190000008042501</strong></p> <h2 id="对象"><a href="#对象" class="header-anchor">#</a> 对象</h2> <h3 id="创建对象的方式"><a href="#创建对象的方式" class="header-anchor">#</a> 创建对象的方式</h3> <p>在Javascript中创建一个对象是非常容易的，方式可总结为如下几种：</p> <ul><li><p>对象字面量</p> <p>以下的定义方式均是合法的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*常规定义*/</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">29</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*属性名也可以为字符串或数字甚至undefined*/</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'T'</span><span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
    <span class="token number">555</span><span class="token operator">:</span> <span class="token number">666</span><span class="token punctuation">,</span>
    <span class="token keyword">undefined</span><span class="token operator">:</span> <span class="token number">777</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span><span class="token string">'T'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">// Tom</span>
obj<span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">// Uncaught ReferenceError: T is not defined</span>
obj<span class="token punctuation">[</span><span class="token number">555</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">// 666</span>
obj<span class="token punctuation">.</span><span class="token number">555</span><span class="token punctuation">;</span> 	<span class="token comment">// Error</span>
obj<span class="token punctuation">[</span><span class="token string">'555'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 666</span>
obj<span class="token punctuation">[</span><span class="token string">'undefined'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">// 777</span>
<span class="token keyword">var</span> temp<span class="token punctuation">;</span>
obj<span class="token punctuation">[</span>temp<span class="token punctuation">]</span><span class="token punctuation">;</span>			<span class="token comment">// 777</span>
</code></pre></div><p>定义对象时，这里的键名会自动转换为字符串。</p></li> <li><p>工厂模式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createObj</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>attr <span class="token operator">=</span> attr<span class="token punctuation">;</span>
    o<span class="token punctuation">.</span><span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> o<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过调用该函数以获取返回的新对象，但每创建一个对象，就要耗费新的内存建立该对象的新方法，不能实现良好的空间利用性。</p></li> <li><p>构造函数模式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 构造函数配合new方式创建 */</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Petter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Person<span class="token punctuation">;</span> 			<span class="token comment">// true</span>
p1<span class="token punctuation">.</span>constructor <span class="token operator">===</span> p2<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span> 	<span class="token comment">// true</span>

<span class="token comment">/* 直接调用，this指向windows */</span>
<span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">'Marry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>name<span class="token punctuation">;</span> 		<span class="token comment">// 'Marry'</span>
window<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span> <span class="token comment">//  Window() { [native code] }</span>
<span class="token comment">/* 通过绑定执行环境调用 */</span>
<span class="token keyword">var</span> p4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>p4<span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p4<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span>		<span class="token comment">//  Object() { [native code] }</span>
</code></pre></div><p>通过new方式，每个创建出来的实例将有一个指向构造函数的属性constructor。并可见，构造函数模式依然无法实现共享资源。</p></li> <li><p>构造+原型模式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>利用在原型对象上添加方法实现资源共用，有关原型的总结见后。</p></li> <li><p>稳妥构造函数模式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token parameter">p1<span class="token punctuation">,</span> p2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> p3 <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>p1 <span class="token operator">/</span> p2<span class="token punctuation">;</span>
    o<span class="token punctuation">.</span><span class="token function-variable function">getRatio</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> p3<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> o<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span>p3<span class="token punctuation">;</span>			<span class="token comment">// undefined</span>
m<span class="token punctuation">.</span><span class="token function">getRatio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 0.75</span>
</code></pre></div><p>所谓稳妥对象指不含有公共属性，且其方法内部不用this的对象。对于其构造函数的调用将不用new的方式，于是便可在构造函数内定义一些私有变量或方法，形成一个安全的环境。</p></li></ul> <h3 id="原型与原型链"><a href="#原型与原型链" class="header-anchor">#</a> 原型与原型链</h3> <p>JavaScript 常被描述为一种基于原型的语言——每个对象拥有一个原型对象，对象以其原型为模板、从原型继承方法和属性。原型对象也可能拥有原型，并从中继承方法和属性，一层一层、以此类推。这种关系常被称为原型链 (prototype chain)。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
    {
        __proto__: {...}
    }
*/</span>
</code></pre></div><p>在javascript中，函数可以有属性。 每个函数都有一个特殊的属性叫作原型，例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> doSomething<span class="token punctuation">.</span>prototype <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
    {
        constructor: ƒ doSomething(),
        __proto__: {
            constructor: ƒ Object(),
            hasOwnProperty: ƒ hasOwnProperty(),
            isPrototypeOf: ƒ isPrototypeOf(),
            propertyIsEnumerable: ƒ propertyIsEnumerable(),
            toLocaleString: ƒ toLocaleString(),
            toString: ƒ toString(),
            valueOf: ƒ valueOf(),
            ...
        }
    }
*/</span>
</code></pre></div><p>我们可以添加一些属性到 doSomething 的原型上面 ：</p> <div class="language-js extra-class"><pre class="language-js"><code>doSomething<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> doSomething<span class="token punctuation">.</span>prototype <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
    {
        foo: &quot;bar&quot;,
        constructor: ƒ doSomething(),
        __proto__: {
            ...
        }
    }
*/</span>
</code></pre></div><p>可以使用new关键字调用构造函数创建实例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
doSomething<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> doSomeInstancing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doSomeInstancing<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token string">&quot;some value&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> doSomeInstancing <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
    {
        prop: &quot;some value&quot;,
        __proto__: {
            foo: &quot;bar&quot;,
            constructor: ƒ doSomething(),
            __proto__: {
                constructor: ƒ Object(),
                hasOwnProperty: ƒ hasOwnProperty(),
                isPrototypeOf: ƒ isPrototypeOf(),
                propertyIsEnumerable: ƒ propertyIsEnumerable(),
                toLocaleString: ƒ toLocaleString(),
                toString: ƒ toString(),
                valueOf: ƒ valueOf()
            }
        }
    }
*/</span>
</code></pre></div><p>当使用new关键字调用构造函数创建对象时，将基于原型构造原型链。如上所见，实例<code>doSomeInstancing</code>的<code>__proto__</code>属性就是doSomething.prototype。当浏览器寻找对象属性时，首先查找对象本身是否有该属性，如果没有，浏览器便会在对象的<code>__proto__</code>中查找这个属性(也就是 doSomething.prototype)，如果有这个属性，那么<code>__proto__</code>上的这个属性就会被使用，否则将继续往上层的<code>__proto__</code>属性查找。此时将查找 doSomeInstancing 的<code>__proto__</code>的<code>__proto__</code>是否有这个属性。<strong>默认情况下，所有函数的原型属性的<code>__proto__</code>就是<code>window.Object.prototype</code></strong>。所以此时<code>Object.prototype</code>会被查找是否有这个属性。最后，原型链上所有的<code>__proto__</code>都被找完了, 浏览器便得出结论，这个属性是 <code>undefined</code>。</p> <p>用一个自定义构造函数A来说，对于普通用new创建的对象可得到如图关系：</p> <p><img src="/assets/img/prototype-chain.7ec37917.jpg" alt="prototype-chain"></p> <p><strong>可以粗俗的理解为：原型对象相当于产品规格，实例即产品，构造函数则是生产机器，生产机器有它自己的产品规格（原型）和制造出生产机器的机器（构造函数）</strong></p> <blockquote><p>注意：</p> <ol><li>Object.prototype.__proto__是一个访问器属性。</li> <li>浏览器查找对象属性最终只到Object.prototype。</li></ol></blockquote> <h3 id="数据属性与访问器属性"><a href="#数据属性与访问器属性" class="header-anchor">#</a> 数据属性与访问器属性</h3> <p>在 ES5 中，属性分为数据属性和访问器属性。</p> <ul><li><p><strong>数据属性</strong></p> <p>有四种描述其行为的特性：</p> <ul><li>[[Configurable]]：表示能否通过delete删除属性，能否修改属性特性，或能否把属性更改为访问器属性，默认值为true。<strong>若设置为false，将不能再设置为true</strong>。</li> <li>[[Enumerable]]：表示能否通过for-in循环返回属性，默认值为true。</li> <li>[[Writable]]：表示能否修改该属性的值，默认值为true。</li> <li>[[Value]]：即该属性的数据值，默认为undefined。</li></ul> <p>最简单地，下述代码便定义了一个obj对象的数据属性aaa：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>aaa <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>

<span class="token comment">/* 可根据ES5方法 
	Object.getOwnPropertyDescriptor(对象, 属性名) 查看属性特性 */</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* {value: 123, writable: true, 
	enumerable: true, configurable: true} */</span>

<span class="token comment">/* 可根据ES5方法
	Object.defineProperty(对象, 属性名, 描述符对象) 重定义属性特性 */</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>writable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>aaa <span class="token operator">=</span> <span class="token number">888</span><span class="token punctuation">;</span>
obj<span class="token punctuation">;</span>	<span class="token comment">// {aaa: 123}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>aaa <span class="token operator">=</span> <span class="token number">888</span><span class="token punctuation">;</span>
obj<span class="token punctuation">;</span>	<span class="token comment">// {aaa: 888}</span>
</code></pre></div><p>在用Object.defineProperty定义属性时，<strong>若不指定configurable, enumerable, writable将为false</strong>。</p></li> <li><p><strong>访问器属性</strong></p> <p>访问器属性不能直接定义，<strong>必须通过Object.defineProperty定义</strong>。</p> <ul><li>[[Configurable]]：同数据属性。</li> <li>[[Enumerable]]：同数据属性。</li> <li>[[Get]]：在读取属性时调用的函数，默认为undefined。</li> <li>[[Set]]：在写入属性时调用的函数，默认为undefined。</li></ul> <p>如下定义了一个可以控制等级level、攻击力attack、血量hp的访问器属性_level：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> monster <span class="token operator">=</span> <span class="token punctuation">{</span>level<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> attack<span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span> hp<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>monster<span class="token punctuation">,</span> <span class="token string">'_level'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>level<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> newValue <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">&amp;&amp;</span> newValue <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            newValue <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> newValue<span class="token punctuation">;</span>			<span class="token comment">// 更新等级</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>attack <span class="token operator">=</span> <span class="token number">20</span><span class="token operator">*</span>newValue <span class="token operator">+</span> <span class="token number">40</span><span class="token punctuation">;</span>	<span class="token comment">// 设定攻击力</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>hp <span class="token operator">=</span> newValue<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">50</span><span class="token operator">*</span>newValue <span class="token operator">+</span> <span class="token number">249</span><span class="token punctuation">;</span> <span class="token comment">// 设定hp</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
monster<span class="token punctuation">.</span>_level <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
<span class="token comment">// monster为 {level: 1, attack: 60, hp: 300}</span>
monster<span class="token punctuation">.</span>_level <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// monster为 {level: 2, attack: 80, hp: 349}</span>
monster<span class="token punctuation">.</span>_level <span class="token operator">=</span> <span class="token number">2.22</span><span class="token punctuation">;</span>
<span class="token comment">// monster为 {level: 3, attack: 100, hp: 402}</span>
monster<span class="token punctuation">.</span>_level <span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token comment">// monster为 {level: 4, attack: 120, hp: 455}</span>
</code></pre></div><p>ES5 还引入了Object.defineProperties方法可以定义多个属性。</p></li></ul> <h3 id="继承的方式"><a href="#继承的方式" class="header-anchor">#</a> 继承的方式</h3> <ul><li><p><strong>原型链继承</strong></p> <p>即 将子实例的构造函数原型指向父构造函数的实例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>superProp <span class="token operator">=</span> <span class="token string">'super'</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>subProp <span class="token operator">=</span> <span class="token string">'sub'</span><span class="token punctuation">}</span>
<span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> subIns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
subIns<span class="token punctuation">.</span>subProp<span class="token punctuation">;</span>		<span class="token comment">// 'sub'</span>
subIns<span class="token punctuation">.</span>superProp<span class="token punctuation">;</span>	<span class="token comment">// 'super'</span>
<span class="token comment">/*	缺点：
	① : 包含引用类型值的原型属性会被所有实例共享
	② : 创建子类型的实例时，不能向超类型的构造函数中传递参数
*/</span>
</code></pre></div></li> <li><p><strong>借用构造函数</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Super</span><span class="token punctuation">(</span><span class="token parameter">p1</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>superProp <span class="token operator">=</span> <span class="token string">'super'</span> <span class="token operator">+</span> p1 <span class="token operator">+</span> <span class="token string">'*'</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">Super</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> subIns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
subIns<span class="token punctuation">.</span>superProp<span class="token punctuation">;</span>	<span class="token comment">// 'super666*'</span>
<span class="token comment">/*	缺点：
	在父类型的原型中定义的方法对子类型而言是不可见的
*/</span>
</code></pre></div></li> <li><p><strong>组合继承（原型链 + 借用构造）</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//继承属性    使用借用构造函数实现对实例属性的继承</span>
      <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">=</span>age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//继承方法     使用原型链实现</span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token operator">=</span>SubType<span class="token punctuation">;</span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayAge</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*	...	*/</span>
</code></pre></div></li> <li><p><strong>原型继承等等</strong></p></li></ul> <h3 id="instanceof-与-typeof"><a href="#instanceof-与-typeof" class="header-anchor">#</a> instanceof 与 typeof</h3> <ul><li><p><strong>typeof</strong></p> <p>typeof 运算符返回一个用来表示表达式的数据类型的字符串，且只能返回：</p> <p><strong>&quot;number&quot;、&quot;string&quot;、&quot;boolean&quot;、&quot;object&quot;、&quot;function&quot; 和 &quot;undefined&quot;</strong></p></li> <li><p><strong>instanceof</strong></p> <p>通过在原型链上查找 object instanceof constructor 是否符合条件来返回true或false</p> <p>因此对于非组合继承的借用构造函数，subIns instanceof Super 为false</p></li></ul> <h3 id="object-assign-浅拷贝-深拷贝"><a href="#object-assign-浅拷贝-深拷贝" class="header-anchor">#</a> Object.assign &amp; 浅拷贝 &amp; 深拷贝</h3> <ul><li><p><strong>Object.assign</strong></p> <p>该方法可将若干对象的属性拷贝至目标对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//语法： Object.assign(目标对象, 源1, 源2, ...);</span>
<span class="token comment">//如下可以复制一个obj对象</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> copy <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { a: 1 }</span>
</code></pre></div><p>该方法拷贝为浅拷贝。</p></li> <li><p><strong>浅拷贝</strong></p> <p>在拷贝时将原对象的属性的引用直接赋给了目标对象，因而目标对象的数据变动可能导致原对象的数据也随之变动：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">shallowCopy</span><span class="token punctuation">(</span><span class="token parameter">des<span class="token punctuation">,</span> src</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> src<span class="token punctuation">)</span><span class="token punctuation">{</span>
        des<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token punctuation">{</span>bb<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> o2 <span class="token operator">=</span> <span class="token punctuation">{</span>b<span class="token operator">:</span> <span class="token punctuation">{</span>bb<span class="token operator">:</span> <span class="token number">33</span><span class="token punctuation">}</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">shallowCopy</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span><span class="token punctuation">;</span>
o1<span class="token punctuation">;</span>		<span class="token comment">// {a: 11, b: {bb: 33}, c: 44}</span>
o2<span class="token punctuation">;</span>		<span class="token comment">// {b: {bb: 33}, c: 44}</span>
o1<span class="token punctuation">.</span>b<span class="token punctuation">.</span>bb <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
o2<span class="token punctuation">;</span>		<span class="token comment">// {b: {bb: 1234}, c: 44}</span>
</code></pre></div></li> <li><p><strong>深拷贝</strong></p> <p>原对象的各项属性就算是数组或对象引用依然重新创建一个新的&quot;值&quot;拷贝：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span><span class="token parameter">des<span class="token punctuation">,</span> src</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> src<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            des<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token function">deepCopy</span><span class="token punctuation">(</span>des<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Array]'</span><span class="token punctuation">)</span> 
            des<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            des<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token punctuation">{</span>bb<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> o2 <span class="token operator">=</span> <span class="token punctuation">{</span>b<span class="token operator">:</span> <span class="token punctuation">{</span>bb<span class="token operator">:</span> <span class="token number">33</span><span class="token punctuation">}</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">deepCopy</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span><span class="token punctuation">;</span>
o1<span class="token punctuation">.</span>b<span class="token punctuation">.</span>bb <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
o2<span class="token punctuation">;</span>		<span class="token comment">// {b: {bb: 33}, c: 44}</span>
</code></pre></div></li></ul> <h2 id="json"><a href="#json" class="header-anchor">#</a> JSON</h2> <h3 id="json介绍"><a href="#json介绍" class="header-anchor">#</a> JSON介绍</h3> <p>在JS中表示对象可用对象字面量, 例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a1<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> a2<span class="token operator">:</span> <span class="token number">456</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>当然其中的属性可以带双引号定义成：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;a1&quot;</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">&quot;a2&quot;</span><span class="token operator">:</span> <span class="token number">456</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>当属性带<strong>双引号</strong>时，这种对象字面量格式便成了JSON，JSON是一种数据格式，而不是一种编程语言，且JSON并不从属于Javascript，很多编程语言都有针对JSON数据结构的解析器和序列化器。</p> <p>标准的JSON文件中定义的JSON，由于不是语句，末尾无需加分号。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">56</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="json-stringify"><a href="#json-stringify" class="header-anchor">#</a> JSON.stringify()</h3> <p>JS中该方法可以将一个对象转换为标准的JSON字符串，该方法接受三个参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* JSON.stringify(对象, 过滤器, 缩进选项) */</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">56</span><span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 无过滤器</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// '{&quot;name&quot;:&quot;Tom&quot;,&quot;age&quot;:56,&quot;id&quot;:6}'</span>
<span class="token comment">// 数组过滤器</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// '{&quot;name&quot;:&quot;Tom&quot;,&quot;id&quot;:6}'</span>
<span class="token comment">// 函数过滤器</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*输出结果：
        key  val {name: &quot;Tom&quot;, age: 56, id: 6}
        key name val Tom
        key age val 56
        key id val 6
        '{&quot;name&quot;:&quot;Tom&quot;,&quot;age&quot;:56,&quot;id&quot;:6}'
    */</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
        	<span class="token keyword">return</span> <span class="token string">'undefined'</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'age'</span><span class="token punctuation">)</span>
        	<span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'id'</span><span class="token punctuation">)</span>
        	<span class="token keyword">return</span> <span class="token number">77</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//	{&quot;name&quot;:&quot;undefined&quot;,&quot;id&quot;:77}</span>
<span class="token comment">// 缩进选项</span>
	<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/*
        '{
            &quot;name&quot;: &quot;Tom&quot;,
            &quot;age&quot;: 56,
            &quot;id&quot;: 6
        }'
	*/</span>
	<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'-哈-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/*
        '{
        -哈-&quot;name&quot;: &quot;Tom&quot;,
        -哈-&quot;age&quot;: 56,
        -哈-&quot;id&quot;: 6
        }'
	*/</span>
</code></pre></div><p>应用函数过滤器选项时，该方法会多次调用函数，且key参数肯定是字符串。第一次调用时传参key为空字符串，val为待序列化的对象本身。</p> <p><strong>因此为了方法能够继续执行，最后函数必须返回val，对于返回undefined的键项将被忽略。</strong></p> <p>特殊情况如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 		<span class="token comment">// 'null'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">// undefined /*该undefined不是字符串*/</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 		<span class="token comment">// '123'</span>
</code></pre></div><h3 id="json-parse"><a href="#json-parse" class="header-anchor">#</a> JSON.parse()</h3> <ul><li><p>JS中该方法可以将一个标准JSON字符串转换为一个JS对象，该方法接受两个参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* JSON.parse(JSON字符串, 还原函数) */</span>
<span class="token keyword">var</span> jsonText <span class="token operator">=</span> <span class="token string">'{&quot;name&quot;:&quot;Tom&quot;,&quot;age&quot;:56,&quot;id&quot;:6}'</span><span class="token punctuation">;</span>
<span class="token comment">// 无还原函数 </span>
	<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonText<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// {name: &quot;Tom&quot;, age: 56, id: 6}</span>
<span class="token comment">// 有还原函数</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonText<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*输出结果：
        key name val Tom
		key age val 56
		key id val 6
		key  val {}
    */</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonText<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">'newName'</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'age'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'id'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">77</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// {name: &quot;newName&quot;, id: 77}</span>
</code></pre></div><p>特殊情况如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// Error</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// Error</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 'null'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'null'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 'null'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'{&quot;a&quot;:123}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// {a: 123}</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;{'a':123}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// Error</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/core/html-css/layout/" class="prev">
        常见布局
      </a></span> <span class="next"><a href="/core/js/es6/">
        ES6特性
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.47ef6698.js" defer></script><script src="/assets/js/2.6d8ae55b.js" defer></script><script src="/assets/js/12.5c9e598e.js" defer></script>
  </body>
</html>
